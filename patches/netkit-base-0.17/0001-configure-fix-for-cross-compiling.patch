From: Michael Olbrich <m.olbrich@pengutronix.de>
Date: Mon, 10 Dec 2012 18:55:04 +0100
Subject: [PATCH] configure: fix for cross-compiling

Signed-off-by: Michael Olbrich <m.olbrich@pengutronix.de>
---
 configure |   18 +++++-------------
 1 file changed, 5 insertions(+), 13 deletions(-)

diff --git a/configure b/configure
index ab603c6..05174cb 100755
--- a/configure
+++ b/configure
@@ -91,7 +91,6 @@ if [ x"$CC" = x ]; then
     for TRY in egcs gcc g++ CC c++ cc; do
        (
            $TRY __conftest.c -o __conftest || exit 1;
-           ./__conftest || exit 1;
        ) >/dev/null 2>&1 || continue;
        CC=$TRY
        break;
@@ -100,21 +99,20 @@ if [ x"$CC" = x ]; then
         echo 'failed.'
         echo 'Cannot find a C compiler. Run configure with --with-c-compiler.'
         rm -f __conftest*
-        exit
+        exit 1
     fi
     echo "$CC"
 else
     echo -n 'Checking if C compiler works... '
     if (
           $CC __conftest.c -o __conftest || exit 1
-          ./__conftest || exit 1
        ) >/dev/null 2>&1; then
          echo 'yes'
      else
          echo 'no'
          echo 'Compiler '"$CC"' does not exist or cannot compile C; try another.'
          rm -f __conftest*
-         exit
+         exit 1
      fi
 fi
 
@@ -187,13 +185,11 @@ int main() {
 EOF
 if (
       $CC $CFLAGS  __conftest.c  -o __conftest || exit 1
-      ./__conftest || exit 1
    ) >/dev/null 2>&1; then
     echo 'yes'
 else
     if (
           $CC $CFLAGS -D__USE_BSD_SIGNAL __conftest.c  -o __conftest || exit 1
-          ./__conftest || exit 1
        ) >/dev/null 2>&1; then
         echo '-D__USE_BSD_SIGNAL'
         CFLAGS="$CFLAGS -D__USE_BSD_SIGNAL"
@@ -201,7 +197,7 @@ else
         echo 'no'
         echo 'This package needs BSD signal semantics to run.'
         rm -f __conftest*
-        exit
+        exit 1
     fi
 fi
 rm -f __conftest*
@@ -241,7 +237,7 @@ else
             echo 'no'
             echo 'Cannot work out what to use for socklen_t. Help...'
             rm -f __conftest*
-            exit
+            exit 1
         fi
     fi
 fi
@@ -266,7 +262,6 @@ if (
 else
     if (
           $CC $CFLAGS -D_GNU_SOURCE __conftest.c  -o __conftest || exit 1
-          ./__conftest || exit 1
        ) >/dev/null 2>&1; then
         echo '-D_GNU_SOURCE'
         CFLAGS="$CFLAGS -D_GNU_SOURCE"
@@ -297,20 +292,17 @@ int main() {
 EOF
 if (
       $CC $CFLAGS  __conftest.c $LIBBSD -o __conftest || exit 1
-      ./__conftest || exit 1
    ) >/dev/null 2>&1; then
     echo 'ok'
 else
     if (
           $CC $CFLAGS  __conftest.c -lsnprintf $LIBBSD -o __conftest || exit 1
-          ./__conftest || exit 1
        ) >/dev/null 2>&1; then
         echo '-lsnprintf'
         LIBS="$LIBS -lsnprintf"
     else
         if (
               $CC $CFLAGS  __conftest.c -ldb $LIBBSD -o __conftest || exit 1
-              ./__conftest || exit 1
            ) >/dev/null 2>&1; then
             echo '-ldb'
             LIBS="$LIBS -ldb"
@@ -318,7 +310,7 @@ else
             echo 'missing'
             echo 'This package requires snprintf.'
             rm -f __conftest*
-            exit
+            exit 1
         fi
     fi
 fi
